<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“Š å®ç›˜æ¨¡æ‹Ÿäº¤æ˜“ç›‘æ§</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .update-time {
            color: rgba(255,255,255,0.8);
            font-size: 0.9em;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-value.positive {
            color: #10b981;
        }
        
        .stat-value.negative {
            color: #ef4444;
        }
        
        .section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #667eea;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: #f8f9fa;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #666;
        }
        
        td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }
        
        .badge-long {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .badge-short {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .badge-buy {
            background: #d1fae5;
            color: #065f46;
        }
        
        .badge-sell {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .profit {
            color: #10b981;
            font-weight: 600;
        }
        
        .loss {
            color: #ef4444;
            font-weight: 600;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š å®ç›˜æ¨¡æ‹Ÿäº¤æ˜“ç›‘æ§</h1>
            <p class="update-time">æœ€åæ›´æ–°: <span id="updateTime">--</span></p>
        </div>
        
        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">ğŸ’° å½“å‰ä½™é¢</div>
                <div class="stat-value" id="balance">$0.00</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ğŸ“ˆ æ€»ç›ˆäº</div>
                <div class="stat-value" id="totalPnl">$0.00</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ğŸ“Š æ€»äº¤æ˜“</div>
                <div class="stat-value" id="totalTrades">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ğŸ¯ èƒœç‡</div>
                <div class="stat-value" id="winRate">0%</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">âœ… ç›ˆåˆ©</div>
                <div class="stat-value positive" id="winningTrades">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">âŒ äºæŸ</div>
                <div class="stat-value negative" id="losingTrades">0</div>
            </div>
        </div>
        
        <!-- æŒä»“ -->
        <div class="section">
            <h2 class="section-title">ğŸ“Š å½“å‰æŒä»“</h2>
            <div id="positionsContent">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>åŠ è½½ä¸­...</p>
                </div>
            </div>
        </div>
        
        <!-- äº¤æ˜“è®°å½• -->
        <div class="section">
            <h2 class="section-title">ğŸ“‹ æœ€è¿‘äº¤æ˜“</h2>
            <div id="tradesContent">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>åŠ è½½ä¸­...</p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // æ›´æ–°æ—¶é—´
        function updateTime() {
            const now = new Date();
            document.getElementById('updateTime').textContent = now.toLocaleString('zh-CN');
        }
        
        // æ ¼å¼åŒ–é‡‘é¢
        function formatMoney(value) {
            return '$' + parseFloat(value).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }
        
        // æ ¼å¼åŒ–ç™¾åˆ†æ¯”
        function formatPercent(value) {
            return (value > 0 ? '+' : '') + parseFloat(value).toFixed(2) + '%';
        }
        
        // åŠ è½½ç»Ÿè®¡æ•°æ®
        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                const data = await response.json();
                
                document.getElementById('balance').textContent = formatMoney(data.balance);
                
                const totalPnl = document.getElementById('totalPnl');
                totalPnl.textContent = formatMoney(data.total_pnl);
                totalPnl.className = 'stat-value ' + (data.total_pnl >= 0 ? 'positive' : 'negative');
                
                document.getElementById('totalTrades').textContent = data.total_trades;
                document.getElementById('winRate').textContent = data.win_rate.toFixed(1) + '%';
                document.getElementById('winningTrades').textContent = data.winning_trades;
                document.getElementById('losingTrades').textContent = data.losing_trades;
                
            } catch (error) {
                console.error('åŠ è½½ç»Ÿè®¡å¤±è´¥:', error);
            }
        }
        
        // åŠ è½½æŒä»“
        async function loadPositions() {
            try {
                const response = await fetch('/api/positions');
                const positions = await response.json();
                
                const content = document.getElementById('positionsContent');
                
                if (positions.length === 0) {
                    content.innerHTML = '<div class="empty-state">ğŸ“­ å½“å‰æ— æŒä»“</div>';
                    return;
                }
                
                let html = '<table><thead><tr>';
                html += '<th>äº¤æ˜“å¯¹</th>';
                html += '<th>ç±»å‹</th>';
                html += '<th>æ•°é‡</th>';
                html += '<th>å…¥åœºä»·</th>';
                html += '<th>å½“å‰ä»·</th>';
                html += '<th>æ æ†</th>';
                html += '<th>æµ®ç›ˆ</th>';
                html += '<th>æ­¢æŸ</th>';
                html += '<th>æ­¢ç›ˆ</th>';
                html += '</tr></thead><tbody>';
                
                positions.forEach(pos => {
                    const pnlClass = pos.unrealized_pnl >= 0 ? 'profit' : 'loss';
                    const pnlText = (pos.unrealized_pnl >= 0 ? '+' : '') + formatMoney(pos.unrealized_pnl) + 
                                   ' (' + formatPercent(pos.unrealized_pnl_pct) + ')';
                    
                    html += '<tr>';
                    html += `<td><strong>${pos.symbol}</strong></td>`;
                    html += `<td><span class="badge badge-long">ğŸ“ˆ åšå¤š</span></td>`;
                    html += `<td>${pos.quantity.toFixed(6)}</td>`;
                    html += `<td>${formatMoney(pos.entry_price)}</td>`;
                    html += `<td>${formatMoney(pos.current_price)}</td>`;
                    html += `<td>${pos.leverage}x</td>`;
                    html += `<td class="${pnlClass}">${pnlText}</td>`;
                    html += `<td>${formatMoney(pos.stop_loss)}</td>`;
                    html += `<td>${formatMoney(pos.take_profit)}</td>`;
                    html += '</tr>';
                });
                
                html += '</tbody></table>';
                content.innerHTML = html;
                
            } catch (error) {
                console.error('åŠ è½½æŒä»“å¤±è´¥:', error);
            }
        }
        
        // åŠ è½½äº¤æ˜“è®°å½•
        async function loadTrades() {
            try {
                const response = await fetch('/api/trades?limit=20');
                const trades = await response.json();
                
                const content = document.getElementById('tradesContent');
                
                if (trades.length === 0) {
                    content.innerHTML = '<div class="empty-state">ğŸ“­ æš‚æ— äº¤æ˜“è®°å½•</div>';
                    return;
                }
                
                let html = '<table><thead><tr>';
                html += '<th>æ—¶é—´</th>';
                html += '<th>äº¤æ˜“å¯¹</th>';
                html += '<th>æ–¹å‘</th>';
                html += '<th>ä»·æ ¼</th>';
                html += '<th>æ•°é‡</th>';
                html += '<th>æ æ†</th>';
                html += '<th>æ‰‹ç»­è´¹</th>';
                html += '<th>ç›ˆäº</th>';
                html += '<th>åŸå› </th>';
                html += '</tr></thead><tbody>';
                
                trades.forEach(trade => {
                    const time = new Date(trade.timestamp).toLocaleString('zh-CN');
                    const badgeClass = trade.side === 'buy' ? 'badge-buy' : 'badge-sell';
                    const sideText = trade.side === 'buy' ? 'ğŸ“ˆ ä¹°å…¥' : 'ğŸ“‰ å–å‡º';
                    
                    html += '<tr>';
                    html += `<td>${time}</td>`;
                    html += `<td><strong>${trade.symbol}</strong></td>`;
                    html += `<td><span class="badge ${badgeClass}">${sideText}</span></td>`;
                    html += `<td>${formatMoney(trade.price)}</td>`;
                    html += `<td>${trade.quantity.toFixed(6)}</td>`;
                    html += `<td>${trade.leverage}x</td>`;
                    html += `<td>${formatMoney(trade.fee)}</td>`;
                    
                    if (trade.side === 'sell' && trade.pnl !== 0) {
                        const pnlClass = trade.pnl >= 0 ? 'profit' : 'loss';
                        const pnlText = (trade.pnl >= 0 ? '+' : '') + formatMoney(trade.pnl) + 
                                       ' (' + formatPercent(trade.pnl_pct) + ')';
                        html += `<td class="${pnlClass}">${pnlText}</td>`;
                    } else {
                        html += `<td>-</td>`;
                    }
                    
                    html += `<td>${trade.reason || '-'}</td>`;
                    html += '</tr>';
                });
                
                html += '</tbody></table>';
                content.innerHTML = html;
                
            } catch (error) {
                console.error('åŠ è½½äº¤æ˜“è®°å½•å¤±è´¥:', error);
            }
        }
        
        // åˆ·æ–°æ‰€æœ‰æ•°æ®
        function refreshAll() {
            updateTime();
            loadStats();
            loadPositions();
            loadTrades();
        }
        
        // åˆå§‹åŠ è½½
        refreshAll();
        
        // æ¯5ç§’è‡ªåŠ¨åˆ·æ–°
        setInterval(refreshAll, 5000);
    </script>
</body>
</html>
