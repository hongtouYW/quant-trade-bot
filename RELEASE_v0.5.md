# 量化交易系统 v0.5 发布说明

**版本代号：** ATR Smart Stop
**发布日期：** 2026-01-29
**访问地址：** http://139.162.41.38:5111/

---

## 版本亮点

### ATR动态止损 (Average True Range)
- **智能止损** - 根据币种波动率自动调整止损距离
- **波动大** → 止损宽 (最高3%)，避免假突破
- **波动小** → 止损紧 (最低1%)，快速止损

---

## 主要更新

### 1. ATR计算函数

```python
def calculate_atr(self, symbol, period=14):
    """计算ATR (Average True Range) - 衡量波动性"""
    # 获取最近14根1小时K线
    # True Range = max(H-L, |H-PC|, |L-PC|)
    # ATR = 平均 True Range
    # ATR% = ATR / 当前价格 * 100
```

### 2. 动态止损逻辑

| 波动率(ATR%) | 止损距离 | 适用场景 |
|-------------|---------|---------|
| < 1.5% | 1.0% | 低波动币 |
| 1.5% - 3% | 1.5x ATR | 中波动币 |
| > 3% | 3.0% | 高波动币 |

**示例：**
```
BTC ATR: 1.2% → 止损: 1.8% (1.5x)
DOGE ATR: 4.5% → 止损: 3.0% (上限)
USDC ATR: 0.1% → 止损: 1.0% (下限)
```

### 3. 移动止盈优化

移动止盈距离也使用ATR动态调整：
- 波动大的币 → 移动距离宽，避免过早触发
- 波动小的币 → 移动距离紧，更快锁定利润

### 4. Dashboard美化

- 卡片间距优化，更紧凑
- 状态颜色区分 (盈利绿/亏损红/持仓蓝)
- 新增开仓/平仓时间显示
- 新增平仓原因显示

---

## 技术改进

### Paper Trader 优化
- `calculate_atr()` - ATR计算函数
- `get_dynamic_stop_pct()` - 动态止损百分比
- `open_position()` - 使用ATR止损
- `check_position()` - ATR移动止盈距离

### Dashboard 优化
- 交易卡片CSS美化
- 显示开仓/平仓时间
- 显示平仓原因

---

## 系统状态

**当前持仓：**
| 币种 | 方向 | 入场价 | 状态 |
|------|------|--------|------|
| XRP | SHORT | $1.9165 | 监控中 |
| SOL | SHORT | $124.59 | 监控中 |
| DUSK | LONG | $0.1466 | 监控中 |
| BNB | SHORT | $892.84 | 监控中 |
| XMR | SHORT | $471.16 | 监控中 |
| ATOM | SHORT | $2.284 | 监控中 |

**服务状态：**
- paper_trader.py: RUNNING
- Dashboard (5111): RUNNING

---

## 下一版本预告 (v0.6)

**计划功能：**
- 分批止盈策略 - 分3批出场，锁定利润
- 时间止盈策略 - 超时自动平仓
- 策略回测验证 - 用历史数据验证

---

## 使用建议

1. **观察ATR日志** - 查看各币种的ATR和止损距离
2. **监控止损移动** - 关注"止损上移/下移"通知
3. **Dashboard查看** - http://139.162.41.38:5111/

---

**版本控制：**
- 上一版本: `v0.4` (Trailing Stop)
- 当前版本: `v0.5` (ATR Smart Stop)

**部署状态：** 已部署到生产环境
